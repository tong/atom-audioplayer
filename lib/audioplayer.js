(function(B,E){function r(a,b){function c(){}c.prototype=a;var f=new c,x;for(x in b)f[x]=b[x];b.toString!==Object.prototype.toString&&(f.toString=b.toString);return f}function F(a){return a instanceof Array?function(){return h.iter(a)}:"function"==typeof a.iterator?k(a,a.iterator):a.iterator}function k(a,b){if(null==b)return null;null==b.__id__&&(b.__id__=G++);var c;null==a.hx__closures__?a.hx__closures__={}:c=a.hx__closures__[b.__id__];null==c&&(c=function(){return c.method.apply(c.scope,arguments)},
c.scope=a,c.method=b,a.hx__closures__[b.__id__]=c);return c}var H=require("atom").CompositeDisposable,v=B.AudioPlayerView=function(a){var b=this;this.player=a;this.wheelSpeed=1;var c=window.getComputedStyle(atom.views.getView(atom.workspace));this.element=window.document.createElement("div");this.element.classList.add("audioplayer");this.element.setAttribute("tabindex","-1");this.waveform=new t(c.color,c.backgroundColor);this.element.appendChild(this.waveform.canvas);this.marker=window.document.createElement("div");
this.marker.classList.add("marker");this.element.appendChild(this.marker);this.element.appendChild(a.audio);this.element.addEventListener("DOMNodeInserted",function(){a.audio.addEventListener("playing",k(b,b.handleAudioPlaying),!1);a.audio.addEventListener("ended",k(b,b.handleAudioEnded),!1);a.audio.addEventListener("error",k(b,b.handleAudioError),!1);a.audio.addEventListener("canplaythrough",function(f){b.waveform.color=c.color;b.waveform.canvas.style.backgroundColor=c.backgroundColor;b.waveform.generate(a.getPath(),
null,function(){b.updateMarker()});b.element.addEventListener("click",k(b,b.handleMouseDown),!1);b.element.addEventListener("mousewheel",k(b,b.handleMouseWheel),!1)},!1)},!1);window.addEventListener("resize",k(this,this.handleResize),!1)};v.__name__=["AudioPlayerView"];v.prototype={update:function(a){this.animationFrameId=window.requestAnimationFrame(k(this,this.update));this.updateMarker()},seek:function(a){null!=this.player.audio.currentTime&&(this.player.audio.currentTime+=a);return this.player.audio.currentTime},
setAudioPositionFromPanePosition:function(a){this.player.audio.currentTime=a/this.element.offsetWidth*this.player.audio.duration},updateMarker:function(){this.marker.style.left=this.player.audio.currentTime/this.player.audio.duration*this.element.offsetWidth+"px"},handleAudioPlaying:function(a){this.animationFrameId=window.requestAnimationFrame(k(this,this.update))},handleAudioEnded:function(a){},handleAudioError:function(a){},handleMouseDown:function(a){this.setAudioPositionFromPanePosition(a.layerX)},
handleMouseUp:function(a){},handleMouseOut:function(a){},handleMouseWheel:function(a){var b=a.wheelDelta/100*this.wheelSpeed;a.ctrlKey&&(b*=10,a.shiftKey&&(b*=10));this.seek(b)},handleResize:function(a){this.waveform.resize()},__class__:v};var t=function(a,b){this.canvas=window.document.createElement("canvas");this.canvas.classList.add("waveform");this.canvas.width=window.innerWidth;this.canvas.height=window.innerHeight;this.color=a;this.canvas.style.backgroundColor=b;this.context=this.canvas.getContext("2d",
null);this.context.fillStyle=a};t.__name__=["Waveform"];t.prototype={generate:function(a,b,c){var f=this;null==b&&(b=window.innerWidth);u.load(d.context,a,function(a,e){null!=a?atom.notifications.addError("Failed to analyze sound data"):(f.peaks=y.getMergedPeaks(e,b),f.drawChannel(f.peaks),null!=c&&c())})},resize:function(){this.canvas.width=window.innerWidth;this.canvas.height=window.innerHeight;this.drawChannel(this.peaks)},drawChannel:function(a){this.context.clearRect(0,0,this.canvas.width,this.canvas.height);
this.context.fillStyle=this.color;for(var b=this.canvas.width/a.length,c=0,f=this.canvas.height/2,e=0;e<a.length;){var d=a[e];++e;this.context.fillRect(c*b,f,b,d*f/2);++c}},__class__:t};var d=B.AudioPlayer=function(a,b,c){null==c&&(c=0);this.file=new I(a);this.audio=window.document.createElement("audio");this.audio.autoplay=b;this.audio.controls=!0;this.audio.src=this.file.getPath();this.audio.currentTime=c};d.__name__=["AudioPlayer"];d.activate=function(a){d.context=new AudioContext;d.disposables.add(atom.workspace.addOpener(d.openURI))};
d.deactivate=function(){d.disposables.dispose()};d.openURI=function(a){return z.has(d.allowedFileTypes,m.extension(a).toLowerCase())?new d(a,atom.config.get("audioplayer.autoplay")):null};d.consumeStatusBar=function(a){};d.deserialize=function(a){return new d(a.path,a.play,a.time)};d.prototype={serialize:function(){return{deserializer:"AudioPlayer",path:this.file.getPath(),play:!this.audio.paused,time:this.audio.currentTime}},dispose:function(){this.audio.pause();this.audio.remove();this.audio=null},
getPath:function(){return this.file.getPath()},getTitle:function(){return this.file.getBaseName()},getURI:function(){var a=this.file.getPath();return"file://"+encodeURIComponent(a)},isEqual:function(a){return e.__instanceof(a,d)?this.getURI()==e.__cast(a,d).getURI():!1},__class__:d};var h=function(){};h.__name__=["HxOverrides"];h.substr=function(a,b,c){if(null==c)c=a.length;else if(0>c)if(0==b)c=a.length+c;else return"";return a.substr(b,c)};h.iter=function(a){return{cur:0,arr:a,hasNext:function(){return this.cur<
this.arr.length},next:function(){return this.arr[this.cur++]}}};var z=function(){};z.__name__=["Lambda"];z.has=function(a,b){for(var c=F(a)();c.hasNext();)if(c.next()==b)return!0;return!1};Math.__name__=["Math"];var w=function(){};w.__name__=["Std"];w.string=function(a){return e.__string_rec(a,"")};var A=function(){};A.__name__=["Type"];A.getClassName=function(a){a=a.__name__;return null==a?null:a.join(".")};var I=require("atom").File,m=function(a){switch(a){case ".":case "..":this.dir=a;this.file=
"";return}var b=a.lastIndexOf("/"),c=a.lastIndexOf("\\");b<c?(this.dir=h.substr(a,0,c),a=h.substr(a,c+1,null),this.backslash=!0):c<b?(this.dir=h.substr(a,0,b),a=h.substr(a,b+1,null)):this.dir=null;b=a.lastIndexOf(".");-1!=b?(this.ext=h.substr(a,b+1,null),this.file=h.substr(a,0,b)):(this.ext=null,this.file=a)};m.__name__=["haxe","io","Path"];m.extension=function(a){a=new m(a);return null==a.ext?"":a.ext};m.prototype={__class__:m};var n=function(a){Error.call(this);this.val=a;this.message=String(a);
Error.captureStackTrace&&Error.captureStackTrace(this,n)};n.__name__=["js","_Boot","HaxeError"];n.wrap=function(a){return a instanceof Error?a:new n(a)};n.__super__=Error;n.prototype=r(Error.prototype,{__class__:n});var e=function(){};e.__name__=["js","Boot"];e.getClass=function(a){if(a instanceof Array&&null==a.__enum__)return Array;var b=a.__class__;if(null!=b)return b;a=e.__nativeClassName(a);return null!=a?e.__resolveNativeClass(a):null};e.__string_rec=function(a,b){if(null==a)return"null";if(5<=
b.length)return"<...>";var c=typeof a;"function"==c&&(a.__name__||a.__ename__)&&(c="object");switch(c){case "function":return"<function>";case "object":if(a instanceof Array){if(a.__enum__){if(2==a.length)return a[0];c=a[0]+"(";b+="\t";for(var f=2,d=a.length;f<d;)var g=f++,c=2!=g?c+(","+e.__string_rec(a[g],b)):c+e.__string_rec(a[g],b);return c+")"}c=a.length;f="[";b+="\t";for(d=0;d<c;)g=d++,f+=(0<g?",":"")+e.__string_rec(a[g],b);return f+"]"}try{f=a.toString}catch(h){return"???"}if(null!=f&&f!=Object.toString&&
"function"==typeof f&&(c=a.toString(),"[object Object]"!=c))return c;c=null;f="{\n";b+="\t";d=null!=a.hasOwnProperty;for(c in a)d&&!a.hasOwnProperty(c)||"prototype"==c||"__class__"==c||"__super__"==c||"__interfaces__"==c||"__properties__"==c||(2!=f.length&&(f+=", \n"),f+=b+c+" : "+e.__string_rec(a[c],b));b=b.substring(1);return f+("\n"+b+"}");case "string":return a;default:return String(a)}};e.__interfLoop=function(a,b){if(null==a)return!1;if(a==b)return!0;var c=a.__interfaces__;if(null!=c)for(var f=
0,d=c.length;f<d;){var g=c[f++];if(g==b||e.__interfLoop(g,b))return!0}return e.__interfLoop(a.__super__,b)};e.__instanceof=function(a,b){if(null==b)return!1;switch(b){case Array:return a instanceof Array?null==a.__enum__:!1;case C:return"boolean"==typeof a;case J:return!0;case D:return"number"==typeof a;case K:return"number"==typeof a?(a|0)===a:!1;case String:return"string"==typeof a;default:if(null!=a)if("function"==typeof b){if(a instanceof b||e.__interfLoop(e.getClass(a),b))return!0}else{if("object"==
typeof b&&e.__isNativeObj(b)&&a instanceof b)return!0}else return!1;return b==L&&null!=a.__name__||b==M&&null!=a.__ename__?!0:a.__enum__==b}};e.__cast=function(a,b){if(e.__instanceof(a,b))return a;throw new n("Cannot cast "+w.string(a)+" to "+w.string(b));};e.__nativeClassName=function(a){a=e.__toStr.call(a).slice(8,-1);return"Object"==a||"Function"==a||"Math"==a||"JSON"==a?null:a};e.__isNativeObj=function(a){return null!=e.__nativeClassName(a)};e.__resolveNativeClass=function(a){return E[a]};require("buffer");
var p=function(a,b){Error.call(this,a);this.message=a;this.pos=b;var c=A.getClassName(e.getClass(this));-1!=c.indexOf(".")&&(c=c.split(".").pop());this.name=c};p.__name__=["om","Error"];p.__super__=Error;p.prototype=r(Error.prototype,{__class__:p});var u=function(){};u.__name__=["om","audio","AudioBufferLoader"];u.load=function(a,b,c){u.loadArrayBuffer(a,b,function(b,d){null!=b?c(b,null):a.decodeAudioData(d,function(a){c(null,a)})})};u.loadArrayBuffer=function(a,b,c){var f=!1,d=new XMLHttpRequest;
d.open("GET",b,!0);d.responseType="arraybuffer";d.onreadystatechange=function(a){200==d.status||f||(f=!0,c(new q(b,{fileName:"AudioBufferLoader.hx",lineNumber:37,className:"om.audio.AudioBufferLoader",methodName:"loadArrayBuffer"}),null))};d.onload=function(a){c(null,d.response)};d.send()};var y=function(){};y.__name__=["om","audio","PeakMeter"];y.getMergedPeaks=function(a,b){for(var c=a.length/b|0,d=~~(c/10|0)|0,e=a.numberOfChannels,g=[],h=0;h<e;)for(var k=h++,n=a.getChannelData(k),p=0;p<b;){for(var l=
p++,m=~~(l*c)|0,u=~~(m+c),q=n[0],r=n[0];m<u;){var t=n[m];t>r&&(r=t);t<q&&(q=t);m+=d}if(0==k||r>g[2*l])g[2*l]=r;if(0==k||q<g[2*l+1])g[2*l+1]=q}return g};var l=function(a,b){p.call(this,""+a+" not found",b);this.location=a};l.__name__=["om","error","NotFound"];l.__super__=p;l.prototype=r(p.prototype,{__class__:l});var q=function(a,b){l.call(this,a,b)};q.__name__=["om","error","FileNotFound"];q.__super__=l;q.prototype=r(l.prototype,{__class__:q});var G=0;module.exports=d;d.disposables=new H;d.disposables.add(atom.views.addViewProvider(d,
function(a){return(new v(a)).element}));String.prototype.__class__=String;String.__name__=["String"];Array.__name__=["Array"];var K={__name__:["Int"]},J={__name__:["Dynamic"]},D=Number;D.__name__=["Float"];var C=Boolean;C.__ename__=["Bool"];var L={__name__:["Class"]},M={};d.allowedFileTypes=["aiff","flac","mp3","ogg","wav"];e.__toStr={}.toString})("undefined"!=typeof exports?exports:"undefined"!=typeof window?window:"undefined"!=typeof self?self:this,"undefined"!=typeof window?window:"undefined"!=
typeof global?global:"undefined"!=typeof self?self:this);
