(function(B,C){function w(a,b){function c(){}c.prototype=a;var p=new c,q;for(q in b)p[q]=b[q];b.toString!==Object.prototype.toString&&(p.toString=b.toString);return p}function D(a){return a instanceof Array?function(){return f.iter(a)}:"function"==typeof a.iterator?e(a,a.iterator):a.iterator}function e(a,b){if(null==b)return null;null==b.__id__&&(b.__id__=E++);var c;null==a.hx__closures__?a.hx__closures__={}:c=a.hx__closures__[b.__id__];null==c&&(c=function(){return c.method.apply(c.scope,arguments)},
c.scope=a,c.method=b,a.hx__closures__[b.__id__]=c);return c}var d=B.AudioPlayer=function(a){var b=this;this.file=new F(a.path);this.isPlaying=!1;this.wheelSpeed=this.seekSpeed=1;var c=window.getComputedStyle(atom.views.getView(atom.workspace));this.element=window.document.createElement("div");this.element.classList.add("audioplayer");this.element.setAttribute("tabindex","-1");this.waveform=new r(c.color,c.backgroundColor);this.element.appendChild(this.waveform.canvas);this.marker=window.document.createElement("div");
this.marker.classList.add("marker");this.element.appendChild(this.marker);this.audio=window.document.createElement("audio");this.audio.controls=!0;this.audio.src=this.file.getPath();this.audio.currentTime=a.time;this.element.appendChild(this.audio);this.audio.addEventListener("playing",e(this,this.handleAudioPlaying),!1);this.audio.addEventListener("ended",e(this,this.handleAudioEnded),!1);this.audio.addEventListener("error",e(this,this.handleAudioError),!1);this.audio.addEventListener("canplaythrough",
e(this,this.handleCanPlayThrough),!1);this.commands=new A;this.commands.add(atom.commands.add(this.element,"audioplayer:toggle-playback",function(a){b.isPlaying?b.pause():b.play()}));this.commands.add(atom.commands.add(this.element,"audioplayer:toggle-mute",function(a){b.audio.muted=!b.audio.muted}));this.commands.add(atom.commands.add(this.element,"audioplayer:seek-backward",function(a){b.seek(-(b.audio.duration/10*b.seekSpeed))}));this.commands.add(atom.commands.add(this.element,"audioplayer:seek-forward",
function(a){b.seek(b.audio.duration/10*b.seekSpeed)}));this.element.addEventListener("click",e(this,this.handleMouseDown),!1);this.element.addEventListener("mousewheel",e(this,this.handleMouseWheel),!1);null!=a.play&&this.play()};d.__name__=["AudioPlayer"];d.activate=function(a){d.context=new AudioContext;d.disposables=new A;d.disposables.add(atom.workspace.addOpener(d.openURI))};d.deactivate=function(){d.disposables.dispose();d.context.close()};d.openURI=function(a){var b=n.extension(a).toLowerCase();
return x.has(d.allowedFileTypes,b)?new d({path:a,play:atom.config.get("audioplayer.autoplay"),time:null}):null};d.consumeStatusBar=function(a){};d.deserialize=function(a){return new d(a)};d.prototype={serialize:function(){return{deserializer:"AudioPlayer",path:this.file.getPath(),play:!this.audio.paused,time:this.audio.currentTime}},dispose:function(){this.commands.dispose();this.element.removeEventListener("click",e(this,this.handleMouseDown));this.element.removeEventListener("mousewheel",e(this,
this.handleMouseWheel));this.audio.removeEventListener("playing",e(this,this.handleAudioPlaying));this.audio.removeEventListener("ended",e(this,this.handleAudioEnded));this.audio.removeEventListener("error",e(this,this.handleAudioError));this.audio.pause();this.audio.remove();this.audio=null},getPath:function(){return this.file.getPath()},getTitle:function(){return this.file.getBaseName()},getURI:function(){var a=this.file.getPath();return"file://"+encodeURIComponent(a)},update:function(a){this.animationFrameId=
window.requestAnimationFrame(e(this,this.update));this.updateMarker()},play:function(){this.isPlaying||(this.isPlaying=!0,this.audio.play())},pause:function(){this.isPlaying&&(this.isPlaying=!1,this.audio.pause())},seek:function(a){null!=this.audio.currentTime&&(this.audio.currentTime+=a);return this.audio.currentTime},setAudioPositionFromPanePosition:function(a){this.audio.currentTime=a/this.element.offsetWidth*this.audio.duration},updateMarker:function(){this.marker.style.left=this.audio.currentTime/
this.audio.duration*this.element.offsetWidth+"px"},togglePlayback:function(){this.isPlaying?this.pause():this.play()},toggleMute:function(){this.audio.muted=!this.audio.muted},handleCanPlayThrough:function(a){var b=this;this.audio.removeEventListener("canplaythrough",e(this,this.handleCanPlayThrough));a=window.getComputedStyle(atom.views.getView(atom.workspace));this.waveform.color=a.color;this.waveform.canvas.style.backgroundColor=a.backgroundColor;this.waveform.generate(this.file.getPath(),null,
function(){b.updateMarker()})},handleAudioPlaying:function(a){this.animationFrameId=window.requestAnimationFrame(e(this,this.update))},handleAudioEnded:function(a){},handleAudioError:function(a){},handleMouseDown:function(a){this.setAudioPositionFromPanePosition(a.layerX)},handleMouseUp:function(a){},handleMouseOut:function(a){},handleMouseWheel:function(a){var b=a.wheelDelta/100*this.wheelSpeed;a.ctrlKey&&(b*=10,a.shiftKey&&(b*=10));this.seek(b)},handleResize:function(a){this.waveform.resize()},
__class__:d};var f=function(){};f.__name__=["HxOverrides"];f.substr=function(a,b,c){if(null==c)c=a.length;else if(0>c)if(0==b)c=a.length+c;else return"";return a.substr(b,c)};f.iter=function(a){return{cur:0,arr:a,hasNext:function(){return this.cur<this.arr.length},next:function(){return this.arr[this.cur++]}}};var x=function(){};x.__name__=["Lambda"];x.has=function(a,b){for(var c=D(a)();c.hasNext();)if(c.next()==b)return!0;return!1};Math.__name__=["Math"];var y=function(){};y.__name__=["Type"];y.getClassName=
function(a){a=a.__name__;return null==a?null:a.join(".")};var r=function(a,b){this.canvas=window.document.createElement("canvas");this.canvas.classList.add("waveform");this.canvas.width=window.innerWidth;this.canvas.height=window.innerHeight;this.color=a;this.canvas.style.backgroundColor=b;this.context=this.canvas.getContext("2d",null);this.context.fillStyle=a};r.__name__=["Waveform"];r.prototype={generate:function(a,b,c){var p=this;null==b&&(b=window.innerWidth);h.load(d.context,a,function(a,d){null!=
a?atom.notifications.addError("Failed to analyze sound data"):(p.peaks=z.getMergedPeaks(d,b),p.draw(p.peaks),null!=c&&c())})},resize:function(){this.canvas.width=window.innerWidth;this.canvas.height=window.innerHeight;this.draw(this.peaks)},draw:function(a){this.context.clearRect(0,0,this.canvas.width,this.canvas.height);this.context.fillStyle=this.color;for(var b=this.canvas.width/a.length,c=0,d=this.canvas.height/2,q=0;q<a.length;){var e=a[q];++q;this.context.fillRect(c*b,d,b,e*d/2);++c}},__class__:r};
var A=require("atom").CompositeDisposable,F=require("atom").File,n=function(a){switch(a){case ".":case "..":this.dir=a;this.file="";return}var b=a.lastIndexOf("/"),c=a.lastIndexOf("\\");b<c?(this.dir=f.substr(a,0,c),a=f.substr(a,c+1,null),this.backslash=!0):c<b?(this.dir=f.substr(a,0,b),a=f.substr(a,b+1,null)):this.dir=null;b=a.lastIndexOf(".");-1!=b?(this.ext=f.substr(a,b+1,null),this.file=f.substr(a,0,b)):(this.ext=null,this.file=a)};n.__name__=["haxe","io","Path"];n.extension=function(a){a=new n(a);
return null==a.ext?"":a.ext};n.prototype={__class__:n};var g=function(){};g.__name__=["js","Boot"];g.getClass=function(a){if(a instanceof Array&&null==a.__enum__)return Array;var b=a.__class__;if(null!=b)return b;a=g.__nativeClassName(a);return null!=a?g.__resolveNativeClass(a):null};g.__nativeClassName=function(a){a=g.__toStr.call(a).slice(8,-1);return"Object"==a||"Function"==a||"Math"==a||"JSON"==a?null:a};g.__resolveNativeClass=function(a){return C[a]};require("buffer");var k=function(a,b){Error.call(this,
a);this.message=a;this.pos=b;var c=y.getClassName(g.getClass(this));-1!=c.indexOf(".")&&(c=c.split(".").pop());this.name=c};k.__name__=["om","Error"];k.__super__=Error;k.prototype=w(Error.prototype,{__class__:k});var h=function(){};h.__name__=["om","audio","AudioBufferLoader"];h.load=function(a,b,c){h.loadArrayBuffer(a,b,function(b,d){null!=b?c(b,null):a.decodeAudioData(d,function(a){c(null,a)})})};h.loadArrayBuffer=function(a,b,c){var d=!1,e=new XMLHttpRequest;e.open("GET",b,!0);e.responseType="arraybuffer";
e.onreadystatechange=function(a){200==e.status||d||(d=!0,c(new l(b,{fileName:"AudioBufferLoader.hx",lineNumber:37,className:"om.audio.AudioBufferLoader",methodName:"loadArrayBuffer"}),null))};e.onload=function(a){c(null,e.response)};e.send()};var z=function(){};z.__name__=["om","audio","PeakMeter"];z.getMergedPeaks=function(a,b){for(var c=a.length/b|0,d=~~(c/10|0)|0,e=a.numberOfChannels,f=[],g=0;g<e;)for(var k=g++,m=a.getChannelData(k),n=0;n<b;){for(var h=n++,l=~~(h*c)|0,r=~~(l+c),t=m[0],u=m[0];l<
r;){var v=m[l];v>u&&(u=v);v<t&&(t=v);l+=d}if(0==k||u>f[2*h])f[2*h]=u;if(0==k||t<f[2*h+1])f[2*h+1]=t}return f};var m=function(a,b){k.call(this,""+a+" not found",b);this.location=a};m.__name__=["om","error","NotFound"];m.__super__=k;m.prototype=w(k.prototype,{__class__:m});var l=function(a,b){m.call(this,a,b)};l.__name__=["om","error","FileNotFound"];l.__super__=m;l.prototype=w(m.prototype,{__class__:l});var E=0;module.exports=d;String.prototype.__class__=String;String.__name__=["String"];Array.__name__=
["Array"];d.allowedFileTypes="flac mp3 ogg opus weba wav".split(" ");g.__toStr={}.toString})("undefined"!=typeof exports?exports:"undefined"!=typeof window?window:"undefined"!=typeof self?self:this,"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this);
